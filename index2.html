<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isolated Video Stream</title>
    
    <!-- Video Player Styles -->
    <link rel="stylesheet" href="https://vaughn.live/5297699007/css/videoplayer_v9.css" />
    <link rel="stylesheet" type="text/css" href="https://vaughn.live/5297699007/css/vsm_65_streamplayer.css" />
    
    <!-- Essential Scripts for Player -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://vaughn.live/1766003897/js/flv_epsilon.js"></script>
    <!-- mpegts is required for the flv playback logic used in the original script -->
    <script src="https://cdn.jsdelivr.net/npm/mpegts.js@1.7.3/dist/mpegts.min.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            overflow: hidden;
        }

        /* Force video to fill container */
        .video-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #MvnHlsPlayerLive {
            width: 100% !important;
            height: 100% !important;
            max-width: 100%;
            max-height: 100%;
        }

        .MvnHlsPlayerOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.7);
            color: white;
            z-index: 10;
        }

        #vs_player_tap_unmute {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            padding: 10px 20px;
            background: #003399;
            color: #fff;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="video-container">
        <button id="vs_player_tap_unmute" style="display:none;">Tap to Unmute</button>
        
        <div class="vidPlayer" style="width: 100%; height: 100%;">
            <div id="MvnHlsPlayer_wrapper" style="width: 100%; height: 100%;">
                <video class="MvnHlsPlayerLive" id="MvnHlsPlayerLive" webkit-playsinline playsinline autoplay></video>
                
                <div class="MvnHlsPlayerOverlay" id="loadingOverlay">
                    <div class="MvnHlsPlayerLoading"></div>
                    <div class="MvnHlsPlayerLoadingText" id="MvnHlsLoadingTxt">Initializing Stream...</div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // Core stream configuration isolated from original page
        var mp4StreamName = "live_thebunnyhole";
        var mp4Player = null;
        var flvPauseLoaded = false;
        var MvnPlayer = { isPlaying: false, isPauseClicked: false }; // Mock player state

        // Re-implementing the stream loading logic
        function loadMp4Stream() {
            var mp4StreamUrl = "https://stream-cdn-iad3.vaughnsoft.net/play/" + mp4StreamName + ".flv";
            var videoElement = document.getElementById('MvnHlsPlayerLive');

            try {
                if (mp4Player != null) {
                    unloadMp4Stream();
                }

                console.log("Connecting to " + mp4StreamUrl);
                
                mp4Player = mpegts.createPlayer({
                    type: 'flv',
                    isLive: true,
                    url: mp4StreamUrl,
                    enableWorker: true,
                    autoCleanupSourceBuffer: true
                });

                mp4Player.attachMediaElement(videoElement);
                mp4Player.load();

                // Handle Autoplay policy
                var playPromise = mp4Player.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        $("#loadingOverlay").fadeOut();
                    }).catch(error => {
                        console.log("Autoplay blocked, showing unmute button");
                        $("#vs_player_tap_unmute").show();
                        videoElement.muted = true;
                        mp4Player.play();
                        $("#loadingOverlay").fadeOut();
                    });
                }

                // Error Handling
                mp4Player.on(mpegts.Events.ERROR, function(e) {
                    console.error("Stream Error:", e);
                    setTimeout(loadMp4Stream, 2000); // Retry on error
                });

            } catch (e) {
                console.error("Initialization Error:", e);
            }
        }

        function unloadMp4Stream() {
            if (mp4Player != null) {
                mp4Player.detachMediaElement();
                mp4Player.unload();
                mp4Player.destroy();
                mp4Player = null;
            }
        }

        // Unmute interaction
        $("#vs_player_tap_unmute").click(function() {
            var video = document.getElementById('MvnHlsPlayerLive');
            video.muted = false;
            $(this).hide();
        });

        // Initialize on load
        $(document).ready(function() {
            loadMp4Stream();
            
            // Basic buffer monitor to prevent getting stuck
            setInterval(function() {
                if (mp4Player && !mp4Player.paused) {
                    try {
                        var video = document.getElementById('MvnHlsPlayerLive');
                        var diff = video.buffered.end(0) - video.currentTime;
                        if (diff > 15) { // If buffer is too far ahead, sync it
                            video.currentTime = video.buffered.end(0) - 1;
                        }
                    } catch(e) {}
                }
            }, 5000);
        });
    </script>
</body>
</html>
